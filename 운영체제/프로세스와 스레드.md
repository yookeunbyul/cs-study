## 프로세스와 스레드

```
프로세스: 운영체제로부터 자원을 할당받은 작업의 단위.

스레드: 프로세스가 할당받은 자원을 이용하는 실행 흐름의 단위.
```

---

### 프로그램 -> 프로세스 -> 스레드

프로그램이란, 파일이 저장 장치에 저장되어 있지만 **메모리에는 올라가 있지 않은 정적인 상태**를 말한다.

운영체제가 독립적인 메모리 공간을 할당해주지 않은.

아직 실행되지 않고 가만히 있는.

즉, **프로그램은 아직 실행되지 않은 파일 자체라는 것이다.**

그럼 프로그램을 실행하면? **메모리(자원)을 할당하고 동적인 상태**가 될 것이다.

이 상태의 프로그램을 **프로세스**라고 한다.

---

### 프로세스 -> 스레드

과거에는 프로그램을 실행할 때 실행 시작부터 실행 끝까지 프로세스 하나만을 사용해서 진행했다고 한다.

근데 요즘은 프로그램이 복잡해지니깐 프로세스를 하나만을 가지고 프로그램을 실행하기가 벅차다.

그럼 여러 프로세스를 사용할까?

안돼. 왜냐, 운영체제는 안전성을 위해 프로세스마다 **자신에게 할당된 메모리 내의 정보에만 접근**할 수 있도록 제약을 두고 있다.

=> `프로세스들끼리 메모리(자원) 공유를 할 수 없다는 거지.`

그래서 **프로세스보다 더 작은 작업단위**의 필요성을 느꼈고 그렇게 **스레드**가 나오게 된 것이다.

즉 스레드는 위와 같은 탄생 배경때문에 프로세스와 달리 **스레드끼리 메모리를 공유하며 작동**한다.

서로 프로세스의 자원을 공유하며 프로세스 실행의 흐름의 일부가 되는 것이다.

---

### 프로세스와 스레드의 작동 방식에 대한 더 자세한 설명

프로그램이 메모리에 올라가면 이제 운영체제로부터 시스템 자원을 할당받아 프로세스가 된다.

이 때 운영체제는 프로세스마다 **각각 독립된 메모리 영역**을, Code/Data/Stack/Heap의 형식으로 할당해준다.

<img src="https://github.com/yookeunbyul/cs-study/assets/91243651/fff0d1c8-8358-428e-bcf3-c42a2a8f7c23" />

**그래서 프로세스끼리 서로 자원을 공유할 수 없다.**

이와 다르게 스레드는 스레드끼리 자원을 서로 공유할 수 있다.

자세히 말하면 stack 형식으로 할당된 메모리 영역은 따로 할당받고 나머지 형식은 서로 공유한다.

따라서 별도의 스택을 가지고 힙 메모리는 서로 읽고 쓸 수 있게 된다.

<img src="https://github.com/yookeunbyul/cs-study/assets/91243651/79dfa028-6076-4331-9a5c-29283b45e10b" />

여기서 둘의 중요한 차이를 하나 알 수 있는데, 만약 프로세스를 실행하다가 오류가 발생해서 강제로 종료된다면 다른 프로세스에게 어떤 영향이 있을까?

**어차피 독립된 영역이기에 아무런 영향을 주지 않는다.**

하지만 스레드는 **서로 stack 메모리 영역을 제외하고 다 공유하고 있기 때문에 스레드 하나에 오류가 발생하면 다른 스레드도 함께 종료가 될 것**이다.

---

### 그렇다면 왜 이런 방식으로 메모리를 공유할까?

**운영체제 관점에서는 프로세스가 최소 작업 단위**가 된다.

**CPU는 작업을 처리할 때 스레드를 최소 단위로 삼고 작업**을 한다.

여기서 중요한 점은 하나의 프로세스는 하나 이상의 스레드를 가진다는 점이다.

이 때문에 같은 프로세스 소속의 스레드끼리 메모리를 공유하지 않을 수 없다.

`어차피 프로세스 안에 있는 건데? 당연히 공유해야지!`

---

### 멀티태스킹, 멀티스레드는 무엇일까?

멀티태스킹이란, 하나의 운영체제 안에서 **여러 프로세스가 실행**되는 것을 의미한다.

멀티태스킹은 자칫하면 **여러 프로세스가 동시에 실행**되는 것처럼 보이지만 자세한 원리를 알아보면 그렇지 않다.

멀티스레드는 **하나의 프로세스가 여러 작업을 여러 스레드를 사용하여 동시에 처리하는 것**을 의미한다.

결국 멀티태스킹(프로세스가 여러개)보다 멀티스레드가... 메모리 자원도 아끼고 공유하고 있으니깐 통신도 빠르다...

```
멀티스레드의 장점

1. Context-Switching할 때 공유하고 있는 메모리만큼의 메모리 자원을 아낄 수 있다.

2. 스레드는 프로세스 내의 Stack 영역을 제외한 모든 메모리를 공유하기 때문에 통신의 부담이 적어서 응답 시간이 빠르다.


멀티스레드의 단점

1. 스레드 하나가 프로세스 내 자원을 망쳐버린다면 모든 프로세스가 종료될 수 있다.
2. 자원을 공유하기 때문에 필연적으로 동기화 문제가 발생할 수밖에 없다.
```

멀티스레드를 사용하면 각각의 스레드 중 어떤 것이 어떤 순서로 실행될 지 그 순서를 알 수 없다.

여러 스레드가 함께 전역 변수를 사용할 경우 발생할 수 있는 충돌을 동기화 문제라고 한다.

다만 스레드의 스케줄링은 운영체제가 처리하지 않기 때문에 프로그래머가 직접 동기화 문제에 대응할 수 있어야 한다.

### 출처

https://velog.io/@raejoonee/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C%EC%9D%98-%EC%B0%A8%EC%9D%B4#%EB%A9%80%ED%8B%B0%ED%83%9C%EC%8A%A4%ED%82%B9-%EB%A9%80%ED%8B%B0%EC%8A%A4%EB%A0%88%EB%93%9C%EB%8A%94-%EB%AC%B4%EC%97%87%EC%9D%BC%EA%B9%8C
