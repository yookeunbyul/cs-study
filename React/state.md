## state

### state를 사용하여 상태관리 하는 이유

1. 지역변수는 **렌더링 간에 유지**되지 않아서

2. 지역변수변경은 **렌더링을 발동시키지 않아서**

위와 같은 문제점을 해결하기 위해서 state를 사용한다.

```
const [index, setIndex] = useState(0);
```

- state 변수 : 렌더링 사이에 데이터를 유지한다. 저장한 값을 갖는다.

- setState함수 : 변수를 업데이트하고 React가 컴포넌트를 다시 렌더링하도록 촉발한다.

<br />

**상태를 저장하여 리렌더링 이후에도 이전의 값을 기억하기 위해서 state 변수를 사용한다.**

**그리고 setState 함수를 이용하여 값을 변화시키고 리렌더링을 촉발시킨다.**

즉, `리렌더링을 촉발시키고 이전의 값을 기억하기 때문에 state를 사용한다.`

---

<br />

### useState는 동기인가 비동기인가

`useState는 비동기로 동작한다.`

왜?

```
하나의 페이지나 컴포넌트에 수많은 상태값이 존재한다. 만약 이 상태가 하나하나 바뀔 때마다 화면을 리렌더링 한다면 문제가 생길 수도 있다.

때문에 setState를 연속으로 호출하면 배치 처리(데이터를 실시간으로 처리하지 않고 한번에 모아서 처리하는 것)하여 한번에 렌더링하도록 하였다.

따라서 연속적으로 두번 호출해도 한번 호출한 것과 동일한 현상이 일어난다.
```

동기적으로 처리하려면,

```
const handleClick = () => {
    setLiked(liked + 1);
    setLiked(liked + 1);
  };
```

이렇게가 아니라

```
const handleClick = () => {
    setLiked((liked) => liked + 1);
    setLiked((liked) => liked + 1);
  };
```

set 함수에 인자를 전달해서 항상 최신값을 참조하도록 한다.

또한, useEffect의 의존성 배열에 state를 넣고 변경될 시 내부에 있는 함수를 실행하는 방법도 있다.

---

<br />

### state가 불변성을 유지해야하는 이유

- 콜스택 => 원시 타입이 저장

  **한 번 생성된 원시 값은 읽기 전용 값으로, 변경 할 수 없다.**

  새로운 값을 재할당할 때는, **새로운 메모리공간을 확보**해 그 곳에 값을 저장한다. 다른 값을 넣는 게 아니라...

  `위와 같은 특징이 불변성이다.`

  자바스크립트에서의 정의는 ‘**메모리 영역의 값을 변경 할 수 없는 것**’

---

<br />

- 메모리힙 => 참조 타입이 저장

  콜스택이 객체랑 함수 들고있을 땐 값이 참조(주소)이고 그걸 가지고 힙을 가리켜 힙 안에 참조 타입의 진짜 값이 들어있는거다...

  그래서 그냥 예를 들어서 push하면 힙에 있는 값만 바뀌는 거니깐 불변성이 깨진다.

  메모리 영역의 값은 변경할 수 없다고 했자나!!!

  그래서 map, spread operator 등 기존의 변수를 변경한 새로운 변수를 반환해서 불변성을 지키는거다.

---

<br />

그래서 왜 불변성을 지켜야하나?

리액트는 **콜스택의 주소값만을 비교하여 상태 변화를 감지**하기 때문이다.

이를 ’얕은 비교’ 라고 한다.

원시 타입은 값을 비교하고, 참조 타입은 그 안의 값을 비교하지 않고, 참조되는 주소(위치)를 비교한다.

어차피 원시 타입은 값이 변경될 수 없고 새로운 메모리를 할당하니깐 변화를 감지할 수 있지만 참조 타입은 값만 변경되면 주소에 변화가 없으니깐 리액트가 변화 감지를 할 수 없다.

즉, 결국 얕은 비교를 하는 리액트를 위해 불변성을 유지해야하는 것이다.

---

<br />

### 출처

https://velog.io/@alstnsrl98/useState%EB%8A%94-%EB%8F%99%EA%B8%B0-%EB%B9%84%EB%8F%99%EA%B8%B0-%EB%8F%99%EA%B8%B0%EC%A0%81-%EC%B2%98%EB%A6%AC

https://hihiha2.tistory.com/172

https://velog.io/@kcj_dev96/%EB%A6%AC%EC%95%A1%ED%8A%B8%EC%97%90%EC%84%9C-state%EA%B0%80-%EB%B6%88%EB%B3%80%EC%84%B1%EC%9D%84-%EC%9C%A0%EC%A7%80%ED%95%B4%EC%95%BC%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0

https://medium.com/@choi-hyunho/react-%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%A9%B4%EC%84%9C-state-%EB%A5%BC-%EB%B3%80%EA%B2%BD-%ED%96%88%EC%A7%80%EB%A7%8C-%EB%A6%AC%EC%95%A1%ED%8A%B8%EA%B0%80-%EC%A0%9C%EB%8C%80%EB%A1%9C-%EA%B0%90%EC%A7%80%ED%95%98%EC%A7%80-%EB%AA%BB%ED%95%98%EC%97%AC-%EB%B3%80%ED%99%94%EA%B0%80-%EC%9D%BC%EC%96%B4%EB%82%98%EC%A7%80-%EC%95%8A%EC%95%84-%EC%9E%90%EB%A3%8C%EB%A5%BC-%EC%B0%BE%EC%95%84%EB%B3%B4%EB%8B%A4%EA%B0%80-5bd91e150f1
