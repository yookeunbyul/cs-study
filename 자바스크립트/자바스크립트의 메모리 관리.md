## 자바스크립트의 메모리 관리

### 메모리의 생명주기

자바스크립트에서, 변수나 함수 등 생각할 수 있는 모든 것들을 만들 때 **JS 엔진은 이에 대한 메모리를 할당하고 더 이상 필요하지 않으면 해제**한다.

<img width="400" alt="image (11)" src="https://github.com/yookeunbyul/cs-study/assets/91243651/af2a88da-963a-43cd-a5b5-6e56dc919f85">

`만듦 => 메모리 할당 => 사용 => 메모리 해제`

메모리 할당은 메모리에 공간을 예약하는 것이고, 메모리를 해체하면 공간이 확보되어 다른 용도로 사용할 수 있다. (메모리는 한정적)

<br />

---

### 메모리의 힙과 스택

JS 엔진에는 **데이터를 저장할 수 있는 힙Heap과 스택Stack이라는 영역**이 존재한다.

- 콜 스택 : 정적 메모리 할당

    <img width="400" alt="image (12)" src="https://github.com/yookeunbyul/cs-study/assets/91243651/f4f5d420-da35-469d-9963-b487055f0e7f">

  스택은 자바스크립트가 **정적 데이터를 저장하는 데 사용하는 자료 구조**이다.

  정적 데이터란 엔진이 **컴파일 타임에 크기를 알고 있는 데이터**를 말한다.

  ```
  원시 타입의 데이터들...(string, number, bigint, boolean, undefined, symbol, null)과 객체 및 함수를 가리키는 참조reference를 저장한다.
  ```

  **크기가 변경되지 않을 것**임을 알고 있으므로, 엔진은 각 값에 대해 **고정된 크기의 메모리를 사전에 할당**한다. 그리고 이렇게 **실행 직전(컴파일 타임)에 메모리를 할당한다는 점에서, 이를 정적 메모리 할당**이라고 한다.

  ***

- 메모리 힙 : 동적 메모리 할당

  힙 역시 `객체와 함수를 저장하는 데이터`를 저장하는데 사용하는 자료 구조이자 공간이다.

  스택과 달리, 엔진은 **고정된 크기의 메모리를 할당하지 않는다.**

  대신 **필요에 따라 더 많은 공간을 할당**한다.

  즉, **동적 메모리 할당**을 한다.

  ***

### 정리

| 스택                                   | 힙                             |
| -------------------------------------- | ------------------------------ |
| 원시 값 및 객체와 함수를 가르키는 참조 | 객체 및 함수를 저장하는 데이터 |
| 컴파일 타임에 크기를 알 수 있음        | 런타임에 크기를 알 수 있음     |
| 고정된 크기의 메모리 할당              | 객체 당 제한 없음              |

<br />

---

### 자바스크립트의 참조

모든 변수는 먼저 스택을 가리킨다.

원시 값이 아니면 스택에 **객체와 함수의 참조가 저장**된다.

참조는 '주소'로, 힙의 객체는 이러한 주소가 가리키는 '집'으로 생각할 수 있다.

<img width="800" alt="image (13)" src="https://github.com/yookeunbyul/cs-study/assets/91243651/8238fe9b-37e6-4369-b82d-ffe5021a496a">

위 그림에서, 다른 값들이 어떻게 저장되는지를 살펴볼 수 있다. person과 newPerson 둘 **모두 같은 객체를 가리키는지를 주목**.

<br />

---

### 가비지 컬렉션

자바스크립트 메모리는 **스택 메모리**와 **힙 메모리**로 구분된다.

스택 영역에는 실행 컨텍스트와 원시 타입의 데이터를 저장하는데 사용되고, 힙 영역은 객체와 함수를 저장하는데 사용된다.

스택 안에 실행 컨텍스트가 push되고 순차적으로 실행되며, 실행이 완료되면 스택에서 pop되어 제거된다.

그럼 더이상 힙 내부 객체들은 참조되지 않기 때문에 필요가 없어진다.

이러한 불필요한 메모리가 힙 내부에 쌓이면 **메모리 누수**(사용되지않은 메모리가 해제되지않고 계속 메모리를 점유하는 것)로 인해 **메모리를 낭비하여 성능이 떨어지게 된다.**

```
따라서, 가비지 컬렉터가 더이상 참조되지 않는 객체를 인지하고, 불필요한 메모리를 해제한다.
```

<br />

---

<br />

- 현재 함수의 지역 변수와 매개변수

- 중첩 함수의 스코프 체인에 있는 함수에서 사용되는 변수와 매개변수

- 전역 변수

위 값들은 **어떻게든 접근하거나 사용할 수 있기에 메모리에서 해제되지 않는 루트**이다.

가비지 컬렉터는 모든 객체를 모니터링하고 루트가 아닌 값, 즉 참조가 없는 값들을 메모리에서 해제한다.

<img src="https://github.com/yookeunbyul/cs-study/assets/91243651/af1f4931-1783-481d-bfce-6e2e35183857" />

**위와 같이 서로 참조하고있더라도 루트가 아닌 값 들이 루트와 연결되어 있지 않으면 가비지 데이터로 식별된다.**

<br />

### 출력

https://east-star.tistory.com/28?category=934153
