## 클로저는 뭘까

```
외부 함수보다 중첩 함수가 더 오래 유지되는 경우 중첩 함수는 이미 생명 주기가 종료된 외부 함수의 변수를 참고할 수 있다. 이러한 중첩 함수를 클로저라고 한다.
(출처: 모던 자바스크립트 Deep Dive 393쪽)
```

<br />

---

### 렉시컬 스코프

자바스크립트 엔진은 어디서 호출했는지가 아니라 **함수를 어디서 정의했는지에 따라 상위 스코프를 결정**한다.

이를 **렉시컬 스코프**(함수를 어디서 정의했는지에 따라 상위 스코프를 결정), 정적 스코프라고 한다.

스코프의 실체는 **실행 컨텍스트의 렉시컬 환경**이다.

렉시컬 환경은 **환경 레코드 컴포넌트**와 **외부 렉시컬 환경에 대한 참조 컴포넌트**로 이루어져있다.

**외부 렉시컬 환경에 대한 참조를 통해 상위 렉시컬 환경과 연결되고, 이가 스코프 체인이다.**

따라서 **함수의 상위 스코프를 결정한다**는 건 **외부 렉시컬 환경에 대한 참조에 저장할 참조값을 결정**하는 것과 같다.

```
렉시컬 환경의 '외부 렉시컬 환경에 대한 참조'에 저장할 참조 값, 즉 상위 스코프에 대한 참조는 함수의 정의가 평가되는 시점에 생성된 함수가 정의된 환경에 의해 결정된다.
```

이것이 바로 **렉시컬 스코프**다.

**함수 객체를 생성할 때 정의된 환경(위치)에 의해 결정된 상위 스코프(즉 상위 렉시컬 환경)의 참조**를 함수 객체 자신의 내부 슬롯 [[Environment]]에 저장된다.

=> 긍까 함수가 정의 될 때 실행 컨텍스트가 생성되면서 상위 스코프에 대한 참조도 함수 내부 슬롯에 저장된다?

따라서 상위 스코프를 기억하게 되는거지..

---

<br />

### 클로저와 렉시컬 환경

```
아... 정의 될때 상위 스코프(상위 렉시컬 환경)에 대한 참조를 내부에 저장하고 있으니깐 외부 함수가 종료되어도 정의될 때 저장된 상위 스코프가 존재하고 있는거지..!!!
```

```
const x = 1;

function outer() {
  const x = 10;
  const inner = function () { console.log(x); };
  return inner;
}

const innerFunc = outer();
innerFunc(); // 10
```

outer 함수의 실행이 종료하면 inner 함수를 반환하면서 outer 함수의 생명주기가 종료된다.

이때 outer 함수의 실행 컨텍스트는 스택에서 제거되지만 outer 함수의 렉시컬 환경까지 소멸되는 건 아니다.

왜? inner 함수가 내부에서 outer 함수를 참조하고있기 때문이다..

이처럼 **자바스크립트의 모든 함수는 상위 스코프를 기억하므로 이론적으로 모든 함수는 클로저**이다.

```
클로저는 아래 두 조건을 갖추어야 합니다.

1.상위 스코프의 식별자를 참조한다.

2.중첩 함수가 외부 함수의 생명 주기보다 길다.
```

---

<br />

### 클로저의 활용

클로저는 **상태(state)를 안전하게 변경하고 유지하기 위해 사용**한다.

즉, 상태가 의도치 않게 변경되지 않도록 상태를 **안전하게 은닉하고 특정 함수에게만 상태 변경을 허용**하기 위해 사용한다는 것을 의미한다.

=> 전역변수로 한다면 누구든지 그 상태를 건들고 변경할 수 있다.

<br />

### 출처

https://east-star.tistory.com/16
