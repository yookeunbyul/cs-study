## JWT(JSON Web Token)

- JSON(JavaScript Object Notation)은 데이터를 주고받기 위해 사용하는 경략이 데이터 형식 중 하나다.

- JSON형식에서는 **키와 값의 쌍으로 이루어진 데이터 객체**를 사용한다.

  ```
  {
      "id" : "gildong",
      "password" : "1234",
      "age" : 30,
      "job" : [
          "progarmmer",
          "dancer"
      ]
  }
  ```

<br />

- 세션의 단점

  - 세션 정보 기록을 서버(데이터베이스)에 기록해놓으니깐 접속자가 많을 때 서버에 메모리 부하가 존재 할 수 있다.

<br />

- Token 인증 방식

  - **세션에 대한 정보에 따른 맵핑 정보를 별도의 데이터베이스에 기록하지않아도 된다.**

    <img width="832" alt="스크린샷 2024-03-01 164226" src="https://github.com/yookeunbyul/cs-study/assets/91243651/f7156787-7aeb-4eaf-86d2-c322e1f208ec">

  1. 아이디와 패스워드를 들고 로그인 요청을 하면

  2. 서버가 적절한 토큰 값을 생성해서 토큰 값을 응답한다. (토근 값에는 회원에 대한 정보가 포함 될 수 O)

  3. 클라이언트는 이 토큰 값을 저장해서 요청을 할 때마다 같이 보내준다.

  4. 그럼 서버는 별도의 키 값을 이용해서 매칭이 되는지를 확인하여 토큰을 검증하여 응답해준다. => 메모리상의 이점이 O

<br />

- JWT란?

  - 인증에 필요한 정보를 암호화한 JSON 형식의 토큰이다.

  - JWT 토큰을 HTTP 헤더에 실어 서버가 클라이언트를 식별할 수 있도록 한다.

  - JWT는 세가지 구성요소를 가진다. => 사용자가 인증을 수행하면 서버는 JWT 토큰을 발급한다.

    - Header : 사용할 해시 알고리즘 등의 메타 정보를 포함

    - Payload : 키와 값의 형식으로 이루어진 정보의 구성 => 이 값을 서버로 전달

    - Signature : (헤더 + 페이로드 + 키)정보를 해싱하여 Client에게 함께 전달한다.

    ```
    xxxxx[Header].yyyyy[Payload].zzzzz[Signature]
    ```

<br />

- JWT를 이용한 인증

  - 나중에 사용자는 자신이 받았던 JWT 토큰을 다시 서버에 전달한다.

  - 서버는 Signature가 사용자로부터 전달받은것과 일치하는지 체크한다. => 이 과정에서 서버가 가지고 있는 **비밀키**를 사용한다.

<br />

- JWT 인증 원리

  - 사용자는 서버가 처음에 부여했던 권한만큼의 작업을 요청할 수 있다.

  - 데이터를 변경하면 해시 값이 변경되므로, 악의적인 공격자가 Payload를 수정하는 것이 불가능하다.

  => 이미 데이터를 가지고 해싱을 했기 때문에 데이터가 변경되면 바로 알아차릴 수 있다.

<br />

- JWT 방식의 특징

  [장점]

  - 세셩 기반 인증 방식에 비해 서버가 DB에 세션 정보를 가지고 있을 필요가 없다.

  - 각 해시 값이 어떤 Header와 Payload를 가지는지 일일이 서버 DB에 저장할 이유가 없다.

  -> **서버에 상태 정보를 저장하지 않아도 되므로, 세션과 달리 무상태성이 유지된다.**

  - 토큰 기반으로, 서로 다른 웹 서버에 대해서도 동작할 수 있다. (웹 브라우저의 쿠키와 다른 점)

  [단점]

  - 세션에 비하여 토큰 자체의 데이터의 길이가 길다.

  - 페이로드는 암호화되지 않으므로, 중요한 정보를 담기 적절하지 않을 수 있다.

  - 토큰을 탈취당하는 경우 보안상의 문제가 발생할 수 있다. (때문에 토큰에 사용 기한을 부여한다. => Refresh Token을 사용)

- JWT 토큰의 유의사항

  - Payload 자체는 중간자 공격에 의해 노출될 수 있으므로, 페이로드에는 가능한 민감정보를 넣지 않는다.

  - **기본적으로 정보보호보다는 위조방지, 서버의 메모리 가용 이점(DB 조회 필요없음)의 목적에 가깝다.**
